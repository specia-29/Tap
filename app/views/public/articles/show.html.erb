<div class="container">
  <div class="row">
    <%= form_with model: @article, url: public_article_path do |f| %>
      <div class="col-lg-9">
        <div class="profile-link mt-2 mb-2">
          <%= image_tag @article.user.profile_image, class: "rounded-circle", size: "50x50" %>
          <%= @article.user.user_name %>
        </div>
        <% if @article.post_image.attached? %>
          <%= image_tag @article.post_image, size: '600x400' %>
        <% end %>

<!--いいね機能-->
        <% if current_user.already_liked?(@article) %>
          <%= button_to 'いいねを取り消す', public_article_like_path(@article), method: :delete %>
        <% else %>
          <%= button_to 'いいね', public_article_likes_path(@article) %>
        <% end %>
        <p>いいね件数: <%= @article.likes.count %></p>
        <%= safe_join(@article.body.split("\n"),tag(:br))%>
      </div>

<!--いいね一覧-->
      <p>いいねしたユーザー</p>
      <% @article.liked_users.each do |user| %>
        <li><%= user.user_name %></li>
      <% end %>

<!--コメント-->
      <div>
        <p>コメント件数：<%= @article.post_comments.count %></p>
        <% @article.post_comments.each do |post_comment| %>
          <%= image_tag post_comment.user.profile_image, class: "rounded-circle", size: "50x50" %>
          <%= post_comment.user.name %>
          <%= post_comment.created_at.strftime('%Y/%m/%d') %><%= post_comment.comment %>
          <% if post_comment.user == current_user %>
            <%= link_to "削除", public_article_post_comment_path(post_comment.article, post_comment), method: :delete %>
          <% end %>
        <% end %>
      </div>
      <div>
        <%= form_with model: [@article, @post_comment] do |f| %>
          <%= f.text_area :comment, rows: '5', placeholder: "コメントをここに" %>
          <%= f.submit "送信する" %>
        <% end %>
      </div>

        <div class="row">
          <div class="col-lg-2 ml-3"></div>
          <% if @article.user == current_user %>
            <%= link_to "投稿を編集", edit_public_article_path(@article),class: 'btn btn-success font-weight-bold border-dark pl-5 pr-5 mr-5' %>
          <% else %>
            <div></div>
          <% end %>
        </div>
  </div>
</div>
<% end %>